{"ast":null,"code":"import React,{createContext,useState,useContext,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext(null);const API_URL=process.env.REACT_APP_API_URL||'http://localhost:5000';export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{const token=localStorage.getItem('token');if(token){verifyToken(token);}else{setLoading(false);}},[]);const verifyToken=async token=>{try{const response=await axios.get(\"\".concat(API_URL,\"/api/auth/verify\"),{headers:{Authorization:\"Bearer \".concat(token)}});setUser(response.data);}catch(error){console.error('Token verification failed',error);logout();}finally{setLoading(false);}};const login=async(email,password)=>{try{if(typeof email!=='string'||typeof password!=='string'){throw new Error('Email and password must be strings');}const response=await axios.post(\"\".concat(API_URL,\"/api/auth/login\"),{email,password});const{user,token}=response.data;setUser(user);localStorage.setItem('token',token);return user;}catch(error){var _error$response;console.error('Login failed',((_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.data)||error.message);throw error;}};const register=async(name,email,password)=>{try{const response=await axios.post(\"\".concat(API_URL,\"/api/auth/register\"),{name,email,password});const{user,token}=response.data;setUser(user);localStorage.setItem('token',token);return user;}catch(error){var _error$response2;console.error('Registration failed',((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.data)||error.message);throw error;}};const loginWithGoogle=()=>{window.location.href=\"\".concat(API_URL,\"/api/auth/google\");};const handleLoginSuccess=token=>{localStorage.setItem('token',token);verifyToken(token);};const logout=()=>{setUser(null);localStorage.removeItem('token');};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,login,loginWithGoogle,handleLoginSuccess,register,logout,loading},children:children});};export const useAuth=()=>useContext(AuthContext);","map":{"version":3,"names":["React","createContext","useState","useContext","useEffect","axios","jsx","_jsx","AuthContext","API_URL","process","env","REACT_APP_API_URL","AuthProvider","_ref","children","user","setUser","loading","setLoading","token","localStorage","getItem","verifyToken","response","get","concat","headers","Authorization","data","error","console","logout","login","email","password","Error","post","setItem","_error$response","message","register","name","_error$response2","loginWithGoogle","window","location","href","handleLoginSuccess","removeItem","Provider","value","useAuth"],"sources":["C:/AUTOLAWN/autolawn-frontend/src/contexts/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useContext, useEffect } from 'react';\r\nimport axios from 'axios';\r\n\r\nconst AuthContext = createContext(null);\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'http://localhost:5000';\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (token) {\r\n      verifyToken(token);\r\n    } else {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  const verifyToken = async (token) => {\r\n    try {\r\n      const response = await axios.get(`${API_URL}/api/auth/verify`, {\r\n        headers: { Authorization: `Bearer ${token}` }\r\n      });\r\n      setUser(response.data);\r\n    } catch (error) {\r\n      console.error('Token verification failed', error);\r\n      logout();\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const login = async (email, password) => {\r\n    try {\r\n      if (typeof email !== 'string' || typeof password !== 'string') {\r\n        throw new Error('Email and password must be strings');\r\n      }\r\n      const response = await axios.post(`${API_URL}/api/auth/login`, { email, password });\r\n      const { user, token } = response.data;\r\n      setUser(user);\r\n      localStorage.setItem('token', token);\r\n      return user;\r\n    } catch (error) {\r\n      console.error('Login failed', error.response?.data || error.message);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const register = async (name, email, password) => {\r\n    try {\r\n      const response = await axios.post(`${API_URL}/api/auth/register`, { name, email, password });\r\n      const { user, token } = response.data;\r\n      setUser(user);\r\n      localStorage.setItem('token', token);\r\n      return user;\r\n    } catch (error) {\r\n      console.error('Registration failed', error.response?.data || error.message);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const loginWithGoogle = () => {\r\n    window.location.href = `${API_URL}/api/auth/google`;\r\n  };\r\n\r\n  const handleLoginSuccess = (token) => {\r\n    localStorage.setItem('token', token);\r\n    verifyToken(token);\r\n  };\r\n\r\n  const logout = () => {\r\n    setUser(null);\r\n    localStorage.removeItem('token');\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, login, loginWithGoogle, handleLoginSuccess, register, logout, loading }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,QAAQ,CAAEC,UAAU,CAAEC,SAAS,KAAQ,OAAO,CAC7E,MAAO,CAAAC,KAAK,KAAM,OAAO,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE1B,KAAM,CAAAC,WAAW,cAAGP,aAAa,CAAC,IAAI,CAAC,CAEvC,KAAM,CAAAQ,OAAO,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,uBAAuB,CAExE,MAAO,MAAM,CAAAC,YAAY,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACvC,KAAM,CAACE,IAAI,CAAEC,OAAO,CAAC,CAAGf,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAACgB,OAAO,CAAEC,UAAU,CAAC,CAAGjB,QAAQ,CAAC,IAAI,CAAC,CAE5CE,SAAS,CAAC,IAAM,CACd,KAAM,CAAAgB,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAIF,KAAK,CAAE,CACTG,WAAW,CAACH,KAAK,CAAC,CACpB,CAAC,IAAM,CACLD,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAI,WAAW,CAAG,KAAO,CAAAH,KAAK,EAAK,CACnC,GAAI,CACF,KAAM,CAAAI,QAAQ,CAAG,KAAM,CAAAnB,KAAK,CAACoB,GAAG,IAAAC,MAAA,CAAIjB,OAAO,qBAAoB,CAC7DkB,OAAO,CAAE,CAAEC,aAAa,WAAAF,MAAA,CAAYN,KAAK,CAAG,CAC9C,CAAC,CAAC,CACFH,OAAO,CAACO,QAAQ,CAACK,IAAI,CAAC,CACxB,CAAE,MAAOC,KAAK,CAAE,CACdC,OAAO,CAACD,KAAK,CAAC,2BAA2B,CAAEA,KAAK,CAAC,CACjDE,MAAM,CAAC,CAAC,CACV,CAAC,OAAS,CACRb,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,KAAM,CAAAc,KAAK,CAAG,KAAAA,CAAOC,KAAK,CAAEC,QAAQ,GAAK,CACvC,GAAI,CACF,GAAI,MAAO,CAAAD,KAAK,GAAK,QAAQ,EAAI,MAAO,CAAAC,QAAQ,GAAK,QAAQ,CAAE,CAC7D,KAAM,IAAI,CAAAC,KAAK,CAAC,oCAAoC,CAAC,CACvD,CACA,KAAM,CAAAZ,QAAQ,CAAG,KAAM,CAAAnB,KAAK,CAACgC,IAAI,IAAAX,MAAA,CAAIjB,OAAO,oBAAmB,CAAEyB,KAAK,CAAEC,QAAS,CAAC,CAAC,CACnF,KAAM,CAAEnB,IAAI,CAAEI,KAAM,CAAC,CAAGI,QAAQ,CAACK,IAAI,CACrCZ,OAAO,CAACD,IAAI,CAAC,CACbK,YAAY,CAACiB,OAAO,CAAC,OAAO,CAAElB,KAAK,CAAC,CACpC,MAAO,CAAAJ,IAAI,CACb,CAAE,MAAOc,KAAK,CAAE,KAAAS,eAAA,CACdR,OAAO,CAACD,KAAK,CAAC,cAAc,CAAE,EAAAS,eAAA,CAAAT,KAAK,CAACN,QAAQ,UAAAe,eAAA,iBAAdA,eAAA,CAAgBV,IAAI,GAAIC,KAAK,CAACU,OAAO,CAAC,CACpE,KAAM,CAAAV,KAAK,CACb,CACF,CAAC,CAED,KAAM,CAAAW,QAAQ,CAAG,KAAAA,CAAOC,IAAI,CAAER,KAAK,CAAEC,QAAQ,GAAK,CAChD,GAAI,CACF,KAAM,CAAAX,QAAQ,CAAG,KAAM,CAAAnB,KAAK,CAACgC,IAAI,IAAAX,MAAA,CAAIjB,OAAO,uBAAsB,CAAEiC,IAAI,CAAER,KAAK,CAAEC,QAAS,CAAC,CAAC,CAC5F,KAAM,CAAEnB,IAAI,CAAEI,KAAM,CAAC,CAAGI,QAAQ,CAACK,IAAI,CACrCZ,OAAO,CAACD,IAAI,CAAC,CACbK,YAAY,CAACiB,OAAO,CAAC,OAAO,CAAElB,KAAK,CAAC,CACpC,MAAO,CAAAJ,IAAI,CACb,CAAE,MAAOc,KAAK,CAAE,KAAAa,gBAAA,CACdZ,OAAO,CAACD,KAAK,CAAC,qBAAqB,CAAE,EAAAa,gBAAA,CAAAb,KAAK,CAACN,QAAQ,UAAAmB,gBAAA,iBAAdA,gBAAA,CAAgBd,IAAI,GAAIC,KAAK,CAACU,OAAO,CAAC,CAC3E,KAAM,CAAAV,KAAK,CACb,CACF,CAAC,CAED,KAAM,CAAAc,eAAe,CAAGA,CAAA,GAAM,CAC5BC,MAAM,CAACC,QAAQ,CAACC,IAAI,IAAArB,MAAA,CAAMjB,OAAO,oBAAkB,CACrD,CAAC,CAED,KAAM,CAAAuC,kBAAkB,CAAI5B,KAAK,EAAK,CACpCC,YAAY,CAACiB,OAAO,CAAC,OAAO,CAAElB,KAAK,CAAC,CACpCG,WAAW,CAACH,KAAK,CAAC,CACpB,CAAC,CAED,KAAM,CAAAY,MAAM,CAAGA,CAAA,GAAM,CACnBf,OAAO,CAAC,IAAI,CAAC,CACbI,YAAY,CAAC4B,UAAU,CAAC,OAAO,CAAC,CAClC,CAAC,CAED,mBACE1C,IAAA,CAACC,WAAW,CAAC0C,QAAQ,EAACC,KAAK,CAAE,CAAEnC,IAAI,CAAEiB,KAAK,CAAEW,eAAe,CAAEI,kBAAkB,CAAEP,QAAQ,CAAET,MAAM,CAAEd,OAAQ,CAAE,CAAAH,QAAA,CAC1GA,QAAQ,CACW,CAAC,CAE3B,CAAC,CAED,MAAO,MAAM,CAAAqC,OAAO,CAAGA,CAAA,GAAMjD,UAAU,CAACK,WAAW,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}